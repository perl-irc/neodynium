/* ABOUTME: Hub server configuration for magnet-9rl on DigitalOcean
/* ABOUTME: Uses Tailscale networking for stable server-to-server communication

/* Server information */
/* IMPORTANT: The name field must match exactly with connect block names on other servers */
serverinfo {
    name = "${SERVER_NAME}.${TAILSCALE_DOMAIN}";
    sid = "${SERVER_SID}";
    description = "${SERVER_DESCRIPTION}";
    network_name = "MagNET";
    ssl_cert = "/opt/solanum/etc/ssl.pem";
    ssl_private_key = "/opt/solanum/etc/ssl.key";
    ssl_dh_params = "/opt/solanum/etc/dh.pem";
};

/* Connection classes needed before connect blocks */
class "server" {
    ping_time = 5 minutes;
    connectfreq = 5 minutes;
    max_autoconn = 2;
    max_number = 10;
    sendq = 2 megabytes;
};

/* Connection blocks */
/* IMPORTANT: Connect block name must match the other server's serverinfo name exactly */
connect "magnet-1eu.${TAILSCALE_DOMAIN}" {
    host = "magnet-1eu.${TAILSCALE_DOMAIN}";
    vhost = "${SERVER_NAME}.${TAILSCALE_DOMAIN}";
    send_password = "${PASSWORD_1EU}";
    accept_password = "${PASSWORD_9RL}";
    port = 6667;
    class = "server";
    flags = topicburst;
};

/* Connect block for services */
connect "magnet-atheme.${TAILSCALE_DOMAIN}" {
    host = "magnet-atheme.${TAILSCALE_DOMAIN}";
    vhost = "${SERVER_NAME}.${TAILSCALE_DOMAIN}";
    send_password = "${SERVICES_PASSWORD}";
    accept_password = "${PASSWORD_9RL}";
    port = 6667;
    class = "server";
    flags = topicburst;
};