/* ABOUTME: Dynamic server configuration for multi-region deployment
/* ABOUTME: Uses environment variables to generate server-specific settings

/* Server information - all dynamically generated */
serverinfo {
    name = "${SERVER_NAME}.${TAILSCALE_DOMAIN}";
    sid = "${SERVER_SID}";
    description = "${SERVER_DESCRIPTION}";
    network_name = "MagNET";
    network_desc = "MagNET IRC Network";
    vhost = "0.0.0.0";
    vhost6 = "::";
};

/* Connection classes needed before connect blocks */
class "server" {
    ping_time = 5 minutes;
    connectfreq = 5 minutes;
    max_autoconn = 10;
    max_number = 20;
    sendq = 2 megabytes;
};

/* Dynamic connection blocks - connect to hub if not in ord region */
/* Hub connection for non-ord regions */
connect "magnet-ord.${TAILSCALE_DOMAIN}" {
    host = "magnet-9rl.internal";
    send_password = "${HUB_LINK_PASSWORD}";
    accept_password = "${REGIONAL_PASSWORD}";
    port = 6667;
    class = "server";
    autoconn = yes;
    aftype = ipv6;
    flags = topicburst;
};

/* Services connection - all servers can accept services */
connect "magnet-atheme.internal" {
    host = "*.magnet-atheme.internal";
    vhost = "${FLY_PRIVATE_IP}";
    send_password = "${SERVICES_PASSWORD}";
    accept_password = "${REGIONAL_PASSWORD}";
    port = 6667;
    class = "server";
    flags = topicburst;
};